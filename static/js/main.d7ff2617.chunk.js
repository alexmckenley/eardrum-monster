(this["webpackJsonpeardrum-monster"]=this["webpackJsonpeardrum-monster"]||[]).push([[0],[,,,function(e,t,n){e.exports=n.p+"static/media/logo.f7341243.svg"},,,,function(e,t,n){e.exports=n(14)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(2),i=n.n(r),c=(n(12),n(6)),s=n(3),l=n.n(s),u=(n(13),n(4)),p=n(5),d=function(){function e(t){Object(u.a)(this,e),this.accessToken=t,this.freshAccessToken=!0,this.player=null}return Object(p.a)(e,[{key:"fetchState",value:function(){return this.player?this.player.getCurrentState():(console.error("Player not initialized"),Promise.reject("player not initialized"))}},{key:"handleNewState",value:function(t){var n=this;if(t)if(t.paused)this.pause();else{var a=e.getUriFromState(t);null!=a?this.player?this.fetchState().then((function(o){null!=o?e.isAd(o)||(e.getUriFromState(o)!==a||!1!==o.paused?n.play(a):Math.abs(t.position-o.position)>1e4&&n.seek(t.position)):n.play(a)})):this.play(a):console.error("new uri is null",t)}}},{key:"pause",value:function(){return this.player.pause()}},{key:"seek",value:function(e){return this.player.seek(e)}},{key:"play",value:function(e){return fetch("https://api.spotify.com/v1/me/player/play?device_id=".concat(this.deviceId),{method:"PUT",body:JSON.stringify({uris:[e]}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then((function(e){e.ok||console.error("error playing uri")}))}},{key:"onPlayerStateChanged",value:function(t){var n=this;this.player.addListener("player_state_changed",(function(a){var o=e.getTrackFromState(a),r=e.getUriFromState(a);r===n.currentSongUri&&(o=null),n.currentSongUri=r,t({newState:a,newSong:o})}))}},{key:"prepareSpotifyClient",value:function(){var e=this;return new Promise((function(t){window.onSpotifyWebPlaybackSDKReady=function(){e.initializePlayer().then(t)};var n=document.createElement("script");n.src="https://sdk.scdn.co/spotify-player.js",document.body.appendChild(n)}))}},{key:"initializePlayer",value:function(){var e=this;return new Promise((function(t){e.player=new window.Spotify.Player({name:"eardrum.monster",getOAuthToken:e.fetchOauthToken.bind(e),volume:.1}),e.player.on("initialization_error",(function(e){var t=e.message;console.error("Failed to initialize",t)})),e.player.on("authentication_error",(function(e){var t=e.message;console.error("Failed to authenticate",t)})),e.player.on("account_error",(function(e){var t=e.message;console.error("Failed to validate Spotify account",t)})),e.player.on("playback_error",(function(e){var t=e.message;console.error("Failed to perform playback",t)})),e.player.on("ready",(function(n){var a=n.device_id;e.deviceId=a,fetch("https://api.spotify.com/v1/me/player",{method:"PUT",body:JSON.stringify({device_ids:[e.deviceId]}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)}}).then((function(e){e.ok?t():console.error("unable to transfer playback to web player")}))})),e.player.connect().then((function(e){e||console.error("Failed to connect to the web player")}))}))}},{key:"fetchOauthToken",value:function(e){this.freshAccessToken||console.error("fetchOauthToken called more than once"),e(this.accessToken)}},{key:"fetchCurrentDeviceId",value:function(){return fetch("https://api.spotify.com/v1/me/player",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then((function(e){return e.ok||console.error("error fetching device id"),e.body.device&&e.body.device.id?(console.log("fetched device ID"),e.body.device.id):null}))}},{key:"setDeviceId",value:function(e){this.deviceId=e}}],[{key:"getTrackFromState",value:function(e){return e&&e.track_window&&e.track_window.current_track?e.track_window.current_track:null}},{key:"getUriFromState",value:function(e){return e&&e.track_window&&e.track_window.current_track?e.track_window.current_track.uri:null}},{key:"isAd",value:function(e){return!!(e&&e.track_window&&e.track_window.current_track)&&"ad"===e.track_window.current_track.type}}]),e}();var h=function(){var e=encodeURIComponent("http://extraloyal.com/eardrum-monster/"),t="https://accounts.spotify.com/authorize?response_type=token&client_id=".concat("d73f9dfa97c44b57ac7cefcc031c4df9","&scope=").concat("streaming+user-read-email+user-read-private+user-read-playback-state+user-modify-playback-state+user-read-currently-playing","&redirect_uri=").concat(e),n=window.localStorage.getItem("spotifyAccessToken"),a=o.a.useState(n),r=Object(c.a)(a,2),i=r[0],s=r[1];if(window.location.hash){var u={};window.location.hash.slice(1).split("&").map((function(e){return e.split("=")})).forEach((function(e){u[e[0]]=e[1]}));var p=u.access_token;window.localStorage.setItem("spotifyAccessToken",p),s(p),window.location.hash=""}return o.a.useEffect((function(){i&&function(){var e=new d(i);e.prepareSpotifyClient().then((function(){return e.fetchState()})).then((function(t){e.play("spotify:track:727LbE4pV6RtLK5FnH1WIe")}))}()}),[i]),o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("h1",{className:"App-title"},"EARDRUM MONSTER"),o.a.createElement("img",{src:l.a,className:"App-logo",alt:"logo"}),null!=i?o.a.createElement("a",{className:"App-link",href:"#",onClick:function(e){e.preventDefault(),window.localStorage.removeItem("spotifyAccessToken"),s(null)}},"Logout"):o.a.createElement("a",{className:"App-link",href:t},"Login with Spotify")),o.a.createElement("div",null,o.a.createElement("h2",null,"now playing")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(h,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[7,1,2]]]);
//# sourceMappingURL=main.d7ff2617.chunk.js.map