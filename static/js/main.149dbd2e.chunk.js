(this["webpackJsonpeardrum-monster"]=this["webpackJsonpeardrum-monster"]||[]).push([[0],{108:function(n,e,t){},135:function(n,e,t){n.exports=t(242)},140:function(n,e,t){},141:function(n,e,t){},230:function(n,e,t){},231:function(n,e,t){},232:function(n,e,t){},233:function(n,e,t){},234:function(n,e,t){},235:function(n,e,t){},237:function(n,e,t){},238:function(n,e,t){},242:function(n,e,t){"use strict";t.r(e);var a=t(1),r=t.n(a),i=t(110),s=t.n(i),o=(t(140),t(141),t(2)),l=t(24),u=t(9),c=t(26),m=t(46),d=t(47),p=function(){function n(e,t){if(Object(m.a)(this,n),null==e)throw new Error("Access token was null");this.accessToken=e,this.onUnauthorized=null!==t&&void 0!==t?t:function(){},this.maybeHandle401=this.maybeHandle401.bind(this)}return Object(d.a)(n,[{key:"maybeHandle401",value:function(n){if(401===n.status)throw this.onUnauthorized(),new Error("Unauthorized: ",n);return n}},{key:"fetchUserInfo",value:function(){return fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then(this.maybeHandle401).then((function(n){if(!n.ok)throw n;return n.json()}))}},{key:"fetchCurrentDeviceID",value:function(){return fetch("https://api.spotify.com/v1/me/player",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then(this.maybeHandle401).then((function(n){return n.ok||console.error("error fetching device id"),204===n.status?null:n.json()})).then((function(n){var e;return(null===n||void 0===n||null===(e=n.device)||void 0===e?void 0:e.id)?n.device.id:null}))}},{key:"play",value:function(n,e){var t=null!=e?"?device_id=".concat(e):"";return fetch("https://api.spotify.com/v1/me/player/play/".concat(t),{method:"PUT",body:JSON.stringify({uris:[n]}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then(this.maybeHandle401).then((function(n){n.ok||console.error("Error playing uri",n)}))}},{key:"transferPlayback",value:function(n){return fetch("https://api.spotify.com/v1/me/player",{method:"PUT",body:JSON.stringify({device_ids:[n],play:!0}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then(this.maybeHandle401).then((function(e){if(!e.ok)throw new Error("unable to transfer playback to device: "+n)}))}},{key:"fetchDevices",value:function(){return fetch("https://api.spotify.com/v1/me/player/devices",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then(this.maybeHandle401).then((function(n){if(!n.ok)throw new Error("unable to fetch devices");return n.json()}))}},{key:"fetchCurrentlyPlaying",value:function(){return fetch("https://api.spotify.com/v1/me/player/currently-playing",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then(this.maybeHandle401).then((function(n){if(!n.ok)throw new Error("unable to currently playing");if(204!==n.status)return n.json()}))}},{key:"nextTrack",value:function(){return fetch("https://api.spotify.com/v1/me/player/next",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then(this.maybeHandle401).then((function(n){if(!n.ok)throw new Error("unable to select next track");if(204!==n.status)return n.json()}))}}]),n}(),v=t(18),f=t(243),g="\n  mutation UpdateUser(\n    $input: UpdateUserInput!\n    $condition: ModelUserConditionInput\n  ) {\n    updateUser(input: $input, condition: $condition) {\n      userID\n      latestSongEvent\n      latestListenPing\n      listeningTo\n      songEvents {\n        items {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        nextToken\n      }\n      listeners {\n        items {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        nextToken\n      }\n      displayName\n      userImg\n      phEnabled\n      currentSongEvent {\n        id\n        spotifyURI\n        timestamp\n        position\n        track {\n          uri\n          trackID\n          name\n          durationMs\n          albumName\n          artistName\n          albumImg\n        }\n        userID\n        user {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        type\n      }\n      phCount\n      type\n    }\n  }\n",y="\n  mutation CreateSongEvent(\n    $input: CreateSongEventInput!\n    $condition: ModelSongEventConditionInput\n  ) {\n    createSongEvent(input: $input, condition: $condition) {\n      id\n      spotifyURI\n      timestamp\n      position\n      track {\n        uri\n        trackID\n        name\n        durationMs\n        albumName\n        artistName\n        albumImg\n      }\n      userID\n      user {\n        userID\n        latestSongEvent\n        latestListenPing\n        listeningTo\n        songEvents {\n          items {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          nextToken\n        }\n        listeners {\n          items {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          nextToken\n        }\n        displayName\n        userImg\n        phEnabled\n        currentSongEvent {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        phCount\n        type\n      }\n      type\n    }\n  }\n",h="\n  query UsersByDisplayName(\n    $displayName: String\n    $latestSongEvent: ModelIntKeyConditionInput\n    $sortDirection: ModelSortDirection\n    $filter: ModelUserFilterInput\n    $limit: Int\n    $nextToken: String\n  ) {\n    usersByDisplayName(\n      displayName: $displayName\n      latestSongEvent: $latestSongEvent\n      sortDirection: $sortDirection\n      filter: $filter\n      limit: $limit\n      nextToken: $nextToken\n    ) {\n      items {\n        userID\n        latestSongEvent\n        latestListenPing\n        listeningTo\n        songEvents {\n          items {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          nextToken\n        }\n        listeners {\n          items {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          nextToken\n        }\n        displayName\n        userImg\n        phEnabled\n        currentSongEvent {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        phCount\n        type\n      }\n      nextToken\n    }\n  }\n",E="\n  query SongEventsByUserId(\n    $userID: String\n    $timestamp: ModelIntKeyConditionInput\n    $sortDirection: ModelSortDirection\n    $filter: ModelSongEventFilterInput\n    $limit: Int\n    $nextToken: String\n  ) {\n    songEventsByUserID(\n      userID: $userID\n      timestamp: $timestamp\n      sortDirection: $sortDirection\n      filter: $filter\n      limit: $limit\n      nextToken: $nextToken\n    ) {\n      items {\n        id\n        spotifyURI\n        timestamp\n        position\n        track {\n          uri\n          trackID\n          name\n          durationMs\n          albumName\n          artistName\n          albumImg\n        }\n        userID\n        user {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        type\n      }\n      nextToken\n    }\n  }\n";function I(n){var e;if(null==n)return!1;var t=null!==(e=n.latestSongEvent)&&void 0!==e?e:0;return Math.floor(Date.now()/1e3)-t<30}function b(n){var e;return null!=n&&Math.floor(Date.now()/1e3)-(null!==(e=n.latestListenPing)&&void 0!==e?e:0)<30}function k(n){var e,t;return(null!==(e=null===n||void 0===n||null===(t=n.listeners)||void 0===t?void 0:t.items)&&void 0!==e?e:[]).filter((function(n){return null!=n&&b(n)})).length+1}var D=Object(a.createContext)();function N(){return r.a.createElement("div",{style:{textAlign:"center"}},"Logging in...")}function T(n){var e=encodeURIComponent("https://eardrum.monster/auth/"),t=encodeURIComponent(n);return"https://accounts.spotify.com/authorize?response_type=token&client_id=".concat("d73f9dfa97c44b57ac7cefcc031c4df9","&scope=").concat("streaming+user-read-email+user-read-private+user-read-playback-state+user-modify-playback-state+user-read-currently-playing","&redirect_uri=").concat(e,"&state=").concat(t)}function S(n){var e=n.children,t=Object(c.useLocalStorage)("EMAuthInfo"),a=Object(o.a)(t,2),i=a[0],s=a[1],u=Object(l.h)(),m=Object(l.g)(),d=null===i||void 0===i?void 0:i.username,y=null===i||void 0===i?void 0:i.accessToken,h=null===i||void 0===i?void 0:i.userImg,E=(null===i||void 0===i?void 0:i.displayName)||d,I=null===i||void 0===i?void 0:i.expiresAt;r.a.useEffect((function(){!function(n,e,t){if(t.hash){var a={};t.hash.slice(1).split("&").map((function(n){return n.split("=")})).forEach((function(n){a[n[0]]=n[1]}));var r=a.access_token;if(null==r)return;t.hash="",new p(r).fetchUserInfo().then((function(t){var i,s,o,l=t.id,u=null!==(i=null===(s=t.images)||void 0===s||null===(o=s[0])||void 0===o?void 0:o.url)&&void 0!==i?i:null;v.a.graphql(Object(f.b)("\n  query GetUser($userID: String!) {\n    getUser(userID: $userID) {\n      userID\n      latestSongEvent\n      latestListenPing\n      listeningTo\n      songEvents {\n        items {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        nextToken\n      }\n      listeners {\n        items {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        nextToken\n      }\n      displayName\n      userImg\n      phEnabled\n      currentSongEvent {\n        id\n        spotifyURI\n        timestamp\n        position\n        track {\n          uri\n          trackID\n          name\n          durationMs\n          albumName\n          artistName\n          albumImg\n        }\n        userID\n        user {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        type\n      }\n      phCount\n      type\n    }\n  }\n",{userID:l})).then((function(n){if(null==n.data.getUser)return v.a.graphql(Object(f.b)("\n  mutation CreateUser(\n    $input: CreateUserInput!\n    $condition: ModelUserConditionInput\n  ) {\n    createUser(input: $input, condition: $condition) {\n      userID\n      latestSongEvent\n      latestListenPing\n      listeningTo\n      songEvents {\n        items {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        nextToken\n      }\n      listeners {\n        items {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        nextToken\n      }\n      displayName\n      userImg\n      phEnabled\n      currentSongEvent {\n        id\n        spotifyURI\n        timestamp\n        position\n        track {\n          uri\n          trackID\n          name\n          durationMs\n          albumName\n          artistName\n          albumImg\n        }\n        userID\n        user {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        type\n      }\n      phCount\n      type\n    }\n  }\n",{input:{userID:l,displayName:l,userImg:u,type:"USER"}})).then((function(n){return n.data.createUser.dislayName}));var e,t,a=null===n||void 0===n||null===(e=n.data)||void 0===e||null===(t=e.getUser)||void 0===t?void 0:t.userImg;return null!=u&&u!==a&&v.a.graphql(Object(f.b)(g,{input:{userID:l,userImg:u}})),n.data.getUser.displayName})).then((function(t){n({accessToken:r,username:l,displayName:t,userImg:u,expiresAt:Math.floor(Date.now()/1e3)+3570}),e.push(decodeURIComponent(a.state))})).catch((function(){e.push("/"),console.error("user creation failed")}))}))}}(s,m,u)}),[s,m,u]),r.a.useEffect((function(){if(null!=I&&!function(){try{return window.self!==window.top}catch(n){return!0}}()){var n=null,e=null,t=function(){(n=document.createElement("iframe")).style.display="none",n.src=T("/auth"),document.body.appendChild(n)},a=(null!==I&&void 0!==I?I:0)-Math.floor(Date.now()/1e3);return a>0?e=setTimeout((function(){t()}),1e3*a):t(),function(){null!=e&&clearTimeout(e),null!=n&&n.parentNode.removeChild(n)}}}),[I,u]);var b=r.a.useMemo((function(){return null!=y&&null!=d?{accessToken:y,username:d,userImg:h,displayName:E,logout:function(){return s(null)},retryAuth:function(){s(null),window.location.href=T(window.location.pathname)},setAuthInfo:s}:null}),[d,y,s,h,E]);return r.a.createElement(D.Provider,{value:b},e)}var C=t(41);function w(){return r.a.useContext(D)}t(230);function U(n){var e=n.initialVal,t=n.className,a=n.onSuccess,i=n.onCancel,s=r.a.useState(e),l=Object(o.a)(s,2),u=l[0],c=l[1],m=r.a.useState(null),d=Object(o.a)(m,2),p=d[0],y=d[1],E=w();return r.a.createElement("div",{className:t},r.a.createElement("form",{onSubmit:function(n){if(null!=E){n.preventDefault();var e,t,r=String(u).trim();(e=E.username,t=r,v.a.graphql(Object(f.b)(h,{displayName:t})).then((function(n){var e,t,a;if(null!=(null===n||void 0===n||null===(e=n.data)||void 0===e||null===(t=e.usersByDisplayName)||void 0===t||null===(a=t.items)||void 0===a?void 0:a[0]))throw new Error("Username exists")})).then((function(){return v.a.graphql(Object(f.b)(g,{input:{userID:e,displayName:t}}))}))).then((function(){y(!0),a(r),E.setAuthInfo(Object(C.a)({},E,{displayName:r}))})).catch((function(){y(!1)}))}}},r.a.createElement("label",{className:"ChangeUsername-label"},"New name: "),r.a.createElement("input",{value:u,onChange:function(n){c(n.target.value)}}),r.a.createElement("div",null,r.a.createElement("input",{type:"submit",value:"Submit"}),r.a.createElement("button",{type:"button",onClick:function(){return i()}},"Cancel"))),null===p?null:!1===p?"Error":"Success!")}t(231);var L=function(){var n=r.a.useContext(D),e=T("/broadcast"),t=Object(l.j)("/u/"+(null===n||void 0===n?void 0:n.displayName)),a=r.a.useState(!1),i=Object(o.a)(a,2),s=i[0],c=i[1],m=Object(l.j)("/u/:id"),d=Object(l.g)();return r.a.createElement("header",{className:"Header"},r.a.createElement("div",{className:"Header-titleContainer"},r.a.createElement(u.b,{className:"Header-title",to:"/"},r.a.createElement("span",{className:"Header-titlePrimary"},"eardrum"),r.a.createElement("span",{className:"Header-titleSecondary"},"monster"))),r.a.createElement("div",{className:"Header-controls EMContainer"},null!=n?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"Header-user"},s?r.a.createElement(U,{initialVal:n.displayName,onSuccess:function(e){return function(e){c(!1),(null===m||void 0===m?void 0:m.params)&&n.displayName&&decodeURIComponent(m.params.id).includes(n.displayName)&&d.replace("/u/".concat(encodeURIComponent(e)))}(e)},onCancel:function(){return c(!1)}}):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:"Header-username"},n.displayName," "),r.a.createElement("a",{className:"Header-editUsername",href:"#",onClick:function(n){n.preventDefault(),c(!0)}},"edit")),n.userImg?r.a.createElement("img",{className:"Header-userImg",src:n.userImg,alt:"profile pic"}):n.displayName),null==t?r.a.createElement(u.b,{className:"Header-link button",to:"/u/".concat(encodeURIComponent(n.displayName))},"Host a channel"):r.a.createElement("a",{className:"Header-link button",href:"#",onClick:function(e){e.preventDefault(),n.logout()}},"Logout")):r.a.createElement("a",{className:"Header-link button",href:e},"Host a channel")))},P=t(263);t(232);function x(n){var e=n.hostUserID;return r.a.useEffect((function(){var n=setInterval((function(){var n={userID:e,timestamp:Math.floor(Date.now()/1e3),position:0,spotifyURI:["spotify:track:08KMh61hPslT7sEf2tEgtT","spotify:track:4mFDsq9pt9msJ9ywYvBzHo","spotify:track:59nNxS2V7M4UDH058BU5qJ","spotify:track:1CkrhTdtRhUzPmA8qtr6y6","spotify:track:4mFDsq9pt9msJ9ywYvBzHo","spotify:track:6AynxUt8LJy9S6bovDdFLr","spotify:track:000PzErbB04ALQCv9iYiQm","spotify:track:6AynxUt8LJy9S6bovDdFLr","spotify:track:7JGepQzDnQDYeGxLCTBSsG","spotify:track:4PPrsYpzuRqe4QoCDGAG4b"][(100*Math.random()).toString()[0]],type:"NEW_SONG"};v.a.graphql(Object(f.b)(g,{input:{userID:e,latestSongEvent:Math.floor(Date.now()/1e3)}})),v.a.graphql(Object(f.b)(y,{input:n})).then((function(n){return console.log("Publishing: ",n)}))}),6e4);return function(){clearInterval(n)}}),[e]),r.a.createElement("h1",null,"DevPublisher enabled")}var j=function(){function n(e,t){Object(m.a)(this,n),this.player=e,this.spotifyAPI=t}return Object(d.a)(n,[{key:"fetchState",value:function(){return this.player.getCurrentState()}},{key:"pause",value:function(){return this.player.pause()}},{key:"resume",value:function(){return this.player.resume()}},{key:"seek",value:function(n){return this.player.seek(n)}},{key:"nextTrack",value:function(){return this.player.nextTrack()}},{key:"addStateChangeListener",value:function(n){this.player.addListener("player_state_changed",n)}},{key:"removeStateChangeListener",value:function(n){this.player.removeListener("player_state_changed",n)}},{key:"getDeviceID",value:function(){return this.player.deviceID}},{key:"transferPlayback",value:function(){return this.spotifyAPI.transferPlayback(this.player.deviceID)}}],[{key:"inject",value:function(){return new Promise((function(n){var e,t;if(null===(e=window)||void 0===e||null===(t=e.Spotify)||void 0===t?void 0:t.Player)n();else{window.onSpotifyWebPlaybackSDKReady=function(){n()};var a=document.createElement("script");a.src="https://sdk.scdn.co/spotify-player.js",document.body.appendChild(a)}}))}},{key:"initializePlayer",value:function(e,t,a){return n.__accessToken=t,n.__onUnauthorized=a,n.__spotifyAPI=e,new Promise((function(e,t){var a;if(null==window.EMGlobalPlayerInstance){var r={current:null!==(a=window.localStorage.getItem("EMPlayerVolume"))&&void 0!==a?a:.1.toFixed(2)},i=new window.Spotify.Player({name:"eardrum.monster",getOAuthToken:function(e){e(n.__accessToken),n.__spotifyAPI.fetchUserInfo()},volume:r.current});setInterval((function(){i.getVolume().then((function(n){if("number"===typeof n){var e=n.toFixed(2);e>0&&r.current!==e&&(r.current=e,window.localStorage.setItem("EMPlayerVolume",e))}}))}),5e3),i.on("initialization_error",(function(n){var e=n.message;console.error("Failed to initialize",e),t("initialization_error")})),i.on("authentication_error",(function(e){var t=e.message;console.error("Failed to authenticate",t),n.__onUnauthorized()})),i.on("account_error",(function(n){var e=n.message;console.error("Spotify premium required",e),t("premium_required")})),i.on("playback_error",(function(n){var e=n.message;console.error("Failed to perform playback",e),t("playback_error")})),i.on("ready",(function(n){var t=n.device_id;i.deviceID=t,window.EMGlobalPlayerInstance=i,e(i)})),i.connect().then((function(n){n||console.error("Failed to connect to the web player")})).catch((function(){t()}))}else e(window.EMGlobalPlayerInstance)}))}},{key:"createInstance",value:function(e,t,a){return n.inject().then((function(){return n.initializePlayer(t,e,a)})).then((function(e){return new n(e,t)}))}},{key:"getTrackFromState",value:function(n){var e;return null===n||void 0===n||null===(e=n.track_window)||void 0===e?void 0:e.current_track}}]),n}(),M=Object(a.createContext)({webPlayer:null,webPlayerUnsupported:!1,spotifyAPI:null,lastMutationTimestamp:null,setLastMutationTimestamp:function(){}});function O(n){var e=n.children,t=w(),a=Object(l.g)(),i=r.a.useState(null),s=Object(o.a)(i,2),u=s[0],c=s[1],m=r.a.useState(!1),d=Object(o.a)(m,2),v=d[0],f=d[1],g=r.a.useState(null),y=Object(o.a)(g,2),h=y[0],E=y[1],I=r.a.useState(null),b=Object(o.a)(I,2),k=b[0],D=b[1];r.a.useEffect((function(){if(null==t)c(null),E(null);else{var n=new p(t.accessToken,t.retryAuth);E(n),j.createInstance(t.accessToken,n,t.retryAuth).then((function(n){c(n)})).catch((function(n){switch(n){case"premium_required":a.replace("/premium_required");break;case"initialization_error":case"playback_error":default:c(null),f(!0)}}))}}),[t,a]);var N=r.a.useMemo((function(){return{webPlayer:u,webPlayerUnsupported:v,spotifyAPI:h,lastMutationTimestamp:k,setLastMutationTimestamp:D}}),[u,h,k,v]);return r.a.createElement(M.Provider,{value:N},e)}function $(){var n=r.a.useContext(M);return null===n||void 0===n?void 0:n.spotifyAPI}function B(){return r.a.useContext(M).webPlayerUnsupported}function R(){var n=r.a.useContext(M);return null===n||void 0===n?void 0:n.webPlayer}function _(n){var e=n.song,t=$(),a=R(),i=r.a.useState(null),s=Object(o.a)(i,2),l=s[0],u=s[1],c=r.a.useState(null),m=Object(o.a)(c,2),d=m[0],p=m[1],v=r.a.useRef(null),f=r.a.useState(!1),g=Object(o.a)(f,2),y=g[0],h=g[1];v.current=d;var E=a&&{id:a.getDeviceID(),name:"eardrum.monster"},I=null!==l&&void 0!==l?l:[];null==E||I.find((function(n){return n.id===E.id}))||I.push(E),r.a.useEffect((function(){t&&t.fetchDevices().then((function(n){u(n.devices)}))}),[t]),r.a.useEffect((function(){if(t&&l){var n=l.find((function(n){return!0===n.is_active}));n?(p(n.id),h(!0)):a&&(p(a.getDeviceID()),h(!0))}}),[t,l,a]),r.a.useEffect((function(){v.current&&y&&t&&t.play(e.spotifyURI,v.current)}),[t,e,y]);return r.a.createElement("div",{className:"Listen-controls"},r.a.createElement("div",null,"Playing on device:"),r.a.createElement("select",{value:null!==d&&void 0!==d?d:"",onChange:function(n){var e=n.target.value;t.transferPlayback(e),p(e)}},null===I||void 0===I?void 0:I.map((function(n){return r.a.createElement("option",{key:n.id,value:n.id},n.name)}))))}t(233);var H=t(51),A=t.n(H);var q=function(n){var e,t,a=n.track;return r.a.createElement("div",{className:"Track"},r.a.createElement("img",{className:"Track-albumImg",src:null!==(e=null===a||void 0===a?void 0:a.albumImg)&&void 0!==e?e:A.a,alt:"Album art"}),r.a.createElement("div",{className:"Track-details"},r.a.createElement("p",{className:"Track-name"},null!==(t=null===a||void 0===a?void 0:a.name)&&void 0!==t?t:"Unknown"),r.a.createElement("p",{className:"Track-artist"},null===a||void 0===a?void 0:a.artistName)))};function z(n){var e=n.songs;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"Recently played tracks"),e.map((function(n){return null==n?null:r.a.createElement(q,{track:n.track,key:n.id})})))}t(234);function F(n){var e=n.className;return r.a.createElement("div",{className:e},r.a.createElement("div",{className:"EQBars-container"},r.a.createElement("ol",{className:"EQBars-column"},r.a.createElement("li",{className:"colour-bar"})),r.a.createElement("ol",{className:"EQBars-column"},r.a.createElement("li",{className:"colour-bar"})),r.a.createElement("ol",{className:"EQBars-column"},r.a.createElement("li",{className:"colour-bar"})),r.a.createElement("ol",{className:"EQBars-column"},r.a.createElement("li",{className:"colour-bar"})),r.a.createElement("ol",{className:"EQBars-column"},r.a.createElement("li",{className:"colour-bar"}))))}t(235);function G(n){var e=n.hostUserID,t=n.hostDisplayName,a=n.hostUserImg,i=r.a.useState(!1),s=Object(o.a)(i,2),l=s[0],u=s[1];return r.a.useEffect((function(){var n=setTimeout((function(){u((function(n){return!n}))}),1e4);return function(){clearTimeout(n)}}),[l]),r.a.createElement("div",{className:"Listeners"},r.a.createElement("div",{className:"Listeners-title"},"Listeners"),r.a.createElement("div",{className:"Listeners-list"},r.a.createElement(P.a,{query:Object(f.b)("\n  query UsersByListeningTo(\n    $listeningTo: String\n    $latestListenPing: ModelIntKeyConditionInput\n    $sortDirection: ModelSortDirection\n    $filter: ModelUserFilterInput\n    $limit: Int\n    $nextToken: String\n  ) {\n    usersByListeningTo(\n      listeningTo: $listeningTo\n      latestListenPing: $latestListenPing\n      sortDirection: $sortDirection\n      filter: $filter\n      limit: $limit\n      nextToken: $nextToken\n    ) {\n      items {\n        userID\n        latestSongEvent\n        latestListenPing\n        listeningTo\n        songEvents {\n          items {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          nextToken\n        }\n        listeners {\n          items {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          nextToken\n        }\n        displayName\n        userImg\n        phEnabled\n        currentSongEvent {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        phCount\n        type\n      }\n      nextToken\n    }\n  }\n",{listeningTo:e,sortDirection:"DESC",limit:50}),subscription:Object(f.b)("\n  subscription OnUpdateUserByListeningTo($listeningTo: String) {\n    onUpdateUserByListeningTo(listeningTo: $listeningTo) {\n      userID\n      latestSongEvent\n      latestListenPing\n      listeningTo\n      songEvents {\n        items {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        nextToken\n      }\n      listeners {\n        items {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        nextToken\n      }\n      displayName\n      userImg\n      phEnabled\n      currentSongEvent {\n        id\n        spotifyURI\n        timestamp\n        position\n        track {\n          uri\n          trackID\n          name\n          durationMs\n          albumName\n          artistName\n          albumImg\n        }\n        userID\n        user {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        type\n      }\n      phCount\n      type\n    }\n  }\n",{listeningTo:e}),onSubscriptionMsg:function(n,e){var t,a,r,i,s=e.onUpdateUserByListeningTo,o=null===(t=n.usersByListeningTo)||void 0===t?void 0:t.items;if(null==o||null==s)return console.error("unexpected null Listeners",n),n;var l=o.findIndex((function(n){return n&&n.userID===s.userID})),u=b(s),c=b(o[l]);if(console.log(s.displayName),console.log((null!==(a=s.latestListenPing)&&void 0!==a?a:0)-(null!==(r=null===(i=o[l])||void 0===i?void 0:i.latestListenPing)&&void 0!==r?r:0)),l>=0?o[l]=s:o.push(s),u&&!c){console.log(s.displayName);var m=new Audio("/notif.wav");console.log("isListening: "+u+" wasListening: "+c),console.log("index: ",l),console.log("items: ",o),console.log("onUpdateUserByListeningTo: ",s),m.volume=.2,m.play()}return n}},(function(n){var e,i=n.data,s=n.loading;if(n.error)return r.a.createElement("h3",null,"Error");if(s||!i)return r.a.createElement("h3",null,"Loading...");var o=function(n){return n.filter((function(n){var e;return null!=n&&Math.floor(Date.now()/1e3)-(null!==(e=null===n||void 0===n?void 0:n.latestListenPing)&&void 0!==e?e:0)<30}))}(null!==(e=i.usersByListeningTo&&i.usersByListeningTo.items)&&void 0!==e?e:[]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"Listeners-item"},a&&r.a.createElement("img",{className:"Listeners-userImg",src:a,alt:"Profile Pic"}),r.a.createElement("div",null,t," \u2b50")),o.map((function(n){return null==n?null:r.a.createElement("div",{className:"Listeners-item",key:n.userID},(null===n||void 0===n?void 0:n.userImg)&&r.a.createElement("img",{className:"Listeners-userImg",src:null===n||void 0===n?void 0:n.userImg,alt:"Profile Pic"}),r.a.createElement("span",null,n.displayName||n.userID))})))}))))}var J=t(52),Q=t.n(J);function K(){var n=r.a.useState(!1),e=Object(o.a)(n,2),t=e[0],a=e[1],i=window.NoSleep,s=r.a.useRef(null);r.a.useEffect((function(){return function(){null!=s.current&&s.current.disable()}}),[]);var l=r.a.useCallback((function(n){a(n),n&&null!=i?(s.current=new i,s.current.enable()):s.current.disable()}),[a,i]);return null!=i&&function(){var n=!1,e=window.navigator;if("maxTouchPoints"in e)n=e.maxTouchPoints>0;else if("msMaxTouchPoints"in e)n=e.msMaxTouchPoints>0;else{var t=window.matchMedia&&matchMedia("(pointer:coarse)");if(t&&"(pointer:coarse)"===t.media)n=!!t.matches;else if("orientation"in window)n=!0;else{var a=e.userAgent;n=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(a)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(a)}}return n}()?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"Broadcast-controls"},r.a.createElement("label",{htmlFor:"wlToggle"},"Prevent screen lock"),r.a.createElement(Q.a,{className:"Broadcast-switch",id:"wlToggle",onChange:l,checked:t}))):null}function V(n){var e=n.children,t=n.isListening,a=n.onClick,i=Object(l.h)(),s=r.a.useContext(D);return t?e:r.a.createElement("div",{className:"Listen-startListening"},r.a.createElement("div",{className:"Listen-startListeningMask"},e),r.a.createElement("div",{className:"Listen-startListeningContent"},r.a.createElement(F,{className:"Listen-EQ"})),r.a.createElement("div",{className:"Listen-startListeningContent"},r.a.createElement("a",{className:"Listen-play",href:i.pathname,onClick:a},"\ud83d\udc42",r.a.createElement("span",{className:"Listen-playLink"},null==s?"Login to join \u25b6":"Join \u25b6"),"\ud83d\ude08")))}function W(n,e){return v.a.graphql(Object(f.b)(g,{input:{userID:n,latestListenPing:Math.floor(Date.now()/1e3),listeningTo:e}}))}function Y(n){var e=n.isCurrentlyLive,t=n.songs,a=n.hostUserID,i=n.hostDisplayName,s=r.a.useContext(D),u=Object(l.h)(),m=Object(c.useLocalStorage)("EMisListeningUsername"),d=Object(o.a)(m,2),p=d[0],v=d[1],f=s&&a===String(p),g=window.NoSleep;r.a.useEffect((function(){if(f&&null!=g){var n=new g;return n.enable(),function(){return n.disable()}}}),[f,g]),r.a.useEffect((function(){if(f&&s){W(s.username,a);var n=setInterval((function(){W(s.username,a)}),1e4);return function(){return clearInterval(n)}}}),[f,s,a]);var y=r.a.useCallback((function(n){n.preventDefault(),v(a),null==s&&(window.location.href=T(u.pathname))}),[v,s,u,a]);return e?r.a.createElement(V,{isListening:f,onClick:y},f&&r.a.createElement("p",null,"Listening to ",i,"'s channel!"),f&&r.a.createElement(_,{song:t[0]}),f&&r.a.createElement(K,null),r.a.createElement("div",null,"Now Playing:"),r.a.createElement(q,{track:t[0].track})):r.a.createElement("h1",null,"offline")}var X=function(n){var e=n.hostDisplayName,t=n.hostUserID,a=n.hostUserImg,i=Object(l.h)(),s=Object(l.g)(),o=i.search.includes("DEV=1");return r.a.useEffect((function(){var n=function(n){return v.a.graphql(Object(f.b)("\n  subscription OnUpdateUserByUserId($userID: String) {\n    onUpdateUserByUserID(userID: $userID) {\n      userID\n      latestSongEvent\n      latestListenPing\n      listeningTo\n      songEvents {\n        items {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        nextToken\n      }\n      listeners {\n        items {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        nextToken\n      }\n      displayName\n      userImg\n      phEnabled\n      currentSongEvent {\n        id\n        spotifyURI\n        timestamp\n        position\n        track {\n          uri\n          trackID\n          name\n          durationMs\n          albumName\n          artistName\n          albumImg\n        }\n        userID\n        user {\n          userID\n          latestSongEvent\n          latestListenPing\n          listeningTo\n          songEvents {\n            nextToken\n          }\n          listeners {\n            nextToken\n          }\n          displayName\n          userImg\n          phEnabled\n          currentSongEvent {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          phCount\n          type\n        }\n        type\n      }\n      phCount\n      type\n    }\n  }\n",{userID:n}))}(t).subscribe({next:function(n){if(n){var t,a=null===(t=n.value.data.onUpdateUserByUserID)||void 0===t?void 0:t.displayName;null!=a&&a!==e&&s.replace("/u/".concat(encodeURIComponent(a)))}}});return function(){n.unsubscribe()}}),[t,e,s]),r.a.createElement("div",{className:"Listen EMContainer"},r.a.createElement(P.a,{query:Object(f.b)(E,{userID:t,sortDirection:"DESC",limit:50}),subscription:Object(f.b)("\n  subscription OnCreateSongEvent($userID: String!) {\n    onCreateSongEvent(userID: $userID) {\n      id\n      spotifyURI\n      timestamp\n      position\n      track {\n        uri\n        trackID\n        name\n        durationMs\n        albumName\n        artistName\n        albumImg\n      }\n      userID\n      user {\n        userID\n        latestSongEvent\n        latestListenPing\n        listeningTo\n        songEvents {\n          items {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n          }\n          nextToken\n        }\n        listeners {\n          items {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          nextToken\n        }\n        displayName\n        userImg\n        phEnabled\n        currentSongEvent {\n          id\n          spotifyURI\n          timestamp\n          position\n          track {\n            uri\n            trackID\n            name\n            durationMs\n            albumName\n            artistName\n            albumImg\n          }\n          userID\n          user {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            displayName\n            userImg\n            phEnabled\n            phCount\n            type\n          }\n          type\n        }\n        phCount\n        type\n      }\n      type\n    }\n  }\n",{userID:t}),onSubscriptionMsg:function(n,e){var t,a=e.onCreateSongEvent;return null==(null===n||void 0===n||null===(t=n.songEventsByUserID)||void 0===t?void 0:t.items)?(console.error("bad state in listen",n),n):(n.songEventsByUserID.items.unshift(a),n.songEventsByUserID.items.length>50&&n.songEventsByUserID.items.pop(),n)}},(function(n){var i,s=n.data,l=n.loading;if(n.error)return r.a.createElement("h3",null,"Error");if(l||!s)return r.a.createElement("h3",null,"Loading...");var u=null!==(i=s.songEventsByUserID&&s.songEventsByUserID.items)&&void 0!==i?i:[],c=u.length>0&&I(u[0].user);return r.a.createElement(r.a.Fragment,null,c&&r.a.createElement("div",{className:"Listen-listeners"},r.a.createElement(G,{hostUserID:t,hostDisplayName:e,hostUserImg:a})),r.a.createElement("div",{className:"Listen-trackList"},r.a.createElement("div",{className:"Listen-header"},e,"'s Channel",o&&r.a.createElement(x,{hostUserID:t})),r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,{isCurrentlyLive:c,songs:u,hostDisplayName:e,hostUserID:t}),r.a.createElement(z,{songs:c?u.slice(1):u}))))})))};t(237);function Z(){return r.a.useContext(M)}function nn(n){var e=n.onSongEvent,t=w(),a=$(),i=r.a.useRef((function(){})),s=Z().lastMutationTimestamp;return i.current=function(n){var a,r,i=null===n||void 0===n?void 0:n.item,s=null!==(a=null===n||void 0===n?void 0:n.is_playing)&&void 0!==a&&a;if(null!=i&&!1!==s&&null!=t){var o={uri:i.uri,trackID:i.id,name:i.name,durationMs:i.duration_ms,albumName:i.album.name,artistName:i.artists[0].name,albumImg:i.album.images[0].url},l={userID:t.username,timestamp:Math.floor(Date.now()/1e3),position:Math.floor(null!==(r=null===n||void 0===n?void 0:n.progress_ms)&&void 0!==r?r:0),spotifyURI:i.uri,type:"NEW_SONG"};e(o,l)}},r.a.useEffect((function(){if(a){var n={current:null};return function e(){a.fetchCurrentlyPlaying().then((function(t){var a,r=null===t||void 0===t?void 0:t.progress_ms,s=null===t||void 0===t||null===(a=t.item)||void 0===a?void 0:a.duration_ms,o=null!=r&&null!=s&&r/1e3<30?4e3:(s-r)/1e3<20?3e3:1e4;i.current(t),n.current=setTimeout(e,o)}))}(),function(){null!=n.current&&clearTimeout(n.current)}}}),[a,s,i]),null}function en(n){var e=n.onSongEvent,t=w(),a=R(),i=r.a.useRef((function(){}));return i.current=function(n){var a,r=j.getTrackFromState(n);if(null!=r&&null!=t){var i={uri:r.uri,trackID:r.id,name:r.name,durationMs:r.duration_ms,albumName:r.album.name,artistName:r.artists[0].name,albumImg:r.album.images[0].url},s={userID:t.username,timestamp:Math.floor(Date.now()/1e3),position:Math.floor(null!==(a=n.position)&&void 0!==a?a:0),spotifyURI:r.uri,type:"NEW_SONG"};e(i,s)}},r.a.useEffect((function(){if(null!=a){var n=function(n){return i.current(n)},e={current:function(n){n===a.getDeviceID()?(a.fetchState().then((function(n){i.current(n)})),a.resume()):a.transferPlayback()}};return a.addStateChangeListener(n),a.spotifyAPI.fetchCurrentDeviceID().then((function(n){e.current(n)})),function(){a.removeStateChangeListener(n),e.current=function(){},a.pause()}}}),[a,i]),null}function tn(n){v.a.graphql(Object(f.b)(g,{input:{userID:n,latestSongEvent:Math.floor(Date.now()/1e3)}}))}function an(n){var e=n.currentSongEvent,t=n.onSongEvent,a=w(),i=R(),s=B(),o=r.a.useRef(e),l=function(n,e){var a;if(!(e.spotifyURI===(null===(a=o.current)||void 0===a?void 0:a.spotifyURI))){var r=Object(C.a)({__typename:"SongEvent"},e,{track:Object(C.a)({__typename:"Track"},n),id:Math.random().toString(),user:null});o.current=r,t(r),function(n){return v.a.graphql(Object(f.b)("\n  mutation CreateTrack(\n    $input: CreateTrackInput!\n    $condition: ModelTrackConditionInput\n  ) {\n    createTrack(input: $input, condition: $condition) {\n      uri\n      trackID\n      name\n      durationMs\n      albumName\n      artistName\n      albumImg\n    }\n  }\n",{input:n}))}(n).then((function(){!function(n){v.a.graphql(Object(f.b)(y,{input:n}))}(e)}))}};return r.a.useEffect((function(){if(a){tn(a.username);var n=setInterval((function(){tn(a.username)}),1e4);return function(){return clearInterval(n)}}}),[a]),i?r.a.createElement(en,{onSongEvent:l}):s?r.a.createElement(nn,{onSongEvent:l}):null}t(238);function rn(n){var e=n.count;return n.isEnabled?r.a.createElement("div",{className:"PowerHourInfo"},"Current Song Number: ",r.a.createElement("h1",null,e)):null}function sn(){var n=Object(c.useLocalStorage)("EMPhEnabled",!1),e=Object(o.a)(n,2),t=e[0],a=e[1],i=Object(c.useLocalStorage)("EMPhCount",1),s=Object(o.a)(i,2),l=s[0],u=s[1],m=$(),d=r.a.useRef(),p=Z().setLastMutationTimestamp,v=r.a.useCallback((function(){m.nextTrack().then((function(){p(Date.now())})).catch((function(){console.error("error playing next track")}))}),[m,p]);d.current=function(n){t?(u(l+1),v()):clearInterval(n)};var f=r.a.useCallback((function(n){a(n),n&&(u(1),m&&v())}),[a,u,m,v]);return r.a.useEffect((function(){if(t){var n=setInterval((function(){d.current(n)}),6e4);return function(){clearInterval(n)}}}),[t,d]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"Broadcast-controls"},r.a.createElement("label",{htmlFor:"phToggle"},"Power hour mode"),r.a.createElement(Q.a,{className:"Broadcast-switch",id:"phToggle",onChange:f,checked:t})),r.a.createElement(rn,{count:l,isEnabled:t}))}var on=t(126);function ln(n){var e=n.hostDisplayName,t=w(),a=Object(l.g)(),i=r.a.useState(!1),s=Object(o.a)(i,2),u=s[0],c=s[1];if(null==t||t.displayName!==e)return"".concat(e,"'s Channel");return u?r.a.createElement("div",{className:"Broadcast-heading"},r.a.createElement(U,{initialVal:e,onSuccess:function(n){return function(n){c(!1),a.replace("/u/".concat(encodeURIComponent(n)))}(n)},onCancel:function(){return c(!1)}})):r.a.createElement("div",{className:"Broadcast-heading"},r.a.createElement("div",{className:"Broadcast-headingTitle"},e,"'s Channel"),r.a.createElement("button",{onClick:function(){return c(!0)}},"Edit"))}var un=function(){var n,e=r.a.useContext(D),t=r.a.useState(null),a=Object(o.a)(t,2),i=a[0],s=a[1],l=R(),u=B(),c=r.a.useState(!1),m=Object(o.a)(c,2),d=m[0],p=m[1],g=r.a.useCallback((function(n){s((function(e){return[n].concat(e)}))}),[s]);if(r.a.useEffect((function(){e&&v.a.graphql(Object(f.b)(E,{userID:e.username,sortDirection:"DESC",limit:10})).then((function(n){var e,t,a;s(null!==(e=null===(t=n.data)||void 0===t||null===(a=t.songEventsByUserID)||void 0===a?void 0:a.items)&&void 0!==e?e:[])}))}),[e]),r.a.useEffect((function(){if(d){var n=setTimeout((function(){p(!1)}),2e3);return function(){return clearTimeout(n)}}}),[d]),null==e)return r.a.createElement("div",null,"Login to spotify to set the eardrum monster free");var y=null==i?null:r.a.createElement("div",{className:"Broadcast-history"},r.a.createElement(z,{songs:i.slice(1)})),h="https://eardrum.monster/u/".concat(e.displayName),I=null==l&&!1===u||null==i?r.a.createElement("div",null,"Initializing Spotify..."):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"Broadcast-title"},r.a.createElement(ln,{hostDisplayName:e.displayName})),r.a.createElement("div",{className:"Broadcast-text"},"You are the DJ."),r.a.createElement("div",{className:"Broadcast-text"},r.a.createElement("div",null,"1. Control your spotify like normal to change the music"),r.a.createElement("div",null,"2. keep this page open to continue streaming")),r.a.createElement("div",{className:"Broadcast-text"},"Share this URL to add listeners:",r.a.createElement("input",{value:h,disabled:!0,size:h.length}),r.a.createElement("button",null,r.a.createElement(on.CopyToClipboard,{text:"https://eardrum.monster/u/".concat(e.displayName),onCopy:function(){p(!0)}},r.a.createElement("span",null,d?"Copied!":"Copy")))),r.a.createElement(K,null),r.a.createElement(sn,null),r.a.createElement(F,{className:"Broadcast-streaming"}),r.a.createElement("p",null,"Now playing:"),r.a.createElement("div",{className:"Broadcast-currentTrack"},r.a.createElement(an,{currentSongEvent:i[0],onSongEvent:g}),r.a.createElement(q,{track:null===(n=i[0])||void 0===n?void 0:n.track})));return r.a.createElement("div",{className:"Broadcast EMContainer"},r.a.createElement("div",{className:"Broadcast-listeners"},r.a.createElement(G,{hostUserID:e.username,hostDisplayName:e.displayName,hostUserImg:e.userImg})),r.a.createElement("div",{className:"Broadcast-player"},I,y))};var cn=function(){var n=r.a.useContext(D),e=Object(l.i)().id,t=r.a.useState(null),a=Object(o.a)(t,2),i=a[0],s=a[1],u=r.a.useState(null),c=Object(o.a)(u,2),m=c[0],d=c[1],p=r.a.useState(!1),g=Object(o.a)(p,2),y=g[0],E=g[1],I=decodeURIComponent(e);return r.a.useEffect((function(){null==n||n.displayName!==I?function(n){return v.a.graphql(Object(f.b)(h,{displayName:n,sortDirection:"DESC",limit:1})).then((function(n){var e,t,a;return null===n||void 0===n||null===(e=n.data)||void 0===e||null===(t=e.usersByDisplayName)||void 0===t||null===(a=t.items)||void 0===a?void 0:a[0]}))}(I).then((function(n){if(null==(null===n||void 0===n?void 0:n.userID))throw new Error("Could not locate user");s(n.userID),d(null===n||void 0===n?void 0:n.userImg)})).catch((function(){E(!0)})):s(null===n||void 0===n?void 0:n.username)}),[n,e,I]),y?r.a.createElement("div",{className:"Listen"},"User not found"):null==i?null:(null===n||void 0===n?void 0:n.displayName)===I?r.a.createElement(un,null):r.a.createElement(X,{hostDisplayName:I,hostUserID:i,hostUserImg:m})};t(108);function mn(n){var e=n.img,t=n.cta,a=n.title,i=n.subtitle;return r.a.createElement("div",{className:"Home-user EMCard"},r.a.createElement("img",{className:"Home-userImg",src:null!==e&&void 0!==e?e:A.a,alt:"Album art"}),r.a.createElement("div",{className:"Home-userText"},r.a.createElement("div",{className:"Home-userTitle"},a),r.a.createElement("div",{className:"Home-userSubtitle"},i),t))}function dn(){return r.a.createElement("div",{className:"ChannelList"},r.a.createElement("h2",{className:"Home-title"},"Currently streaming"),r.a.createElement(P.a,{query:Object(f.b)("\n  query UsersByLatestSongEventCustom(\n    $type: String\n    $latestSongEvent: ModelIntKeyConditionInput\n    $sortDirection: ModelSortDirection\n    $filter: ModelUserFilterInput\n    $limit: Int\n    $nextToken: String\n  ) {\n    usersByLatestSongEvent(\n      type: $type\n      latestSongEvent: $latestSongEvent\n      sortDirection: $sortDirection\n      filter: $filter\n      limit: $limit\n      nextToken: $nextToken\n    ) {\n      items {\n        userID\n        displayName\n        userImg\n        latestSongEvent\n        latestListenPing\n        listeningTo\n        songEvents(sortDirection: DESC) {\n          items {\n            id\n            spotifyURI\n            timestamp\n            position\n            userID\n            type\n            track {\n              durationMs\n              name\n              albumName\n              albumImg\n            }\n          }\n          nextToken\n        }\n        listeners(sortDirection: DESC) {\n          items {\n            userID\n            latestSongEvent\n            latestListenPing\n            listeningTo\n            type\n          }\n          nextToken\n        }\n        type\n      }\n      nextToken\n    }\n  }\n",{type:"USER",sortDirection:"DESC",limit:50})},(function(n){var e,t=n.data,a=n.loading;if(n.error)return r.a.createElement("h3",null,"Error");if(a||!t)return r.a.createElement("h3",null,"Loading...");var i=(null!==(e=t.usersByLatestSongEvent&&t.usersByLatestSongEvent.items)&&void 0!==e?e:[]).filter((function(n){return I(n)})).sort((function(n,e){return k(n)>k(e)?-1:1}));return r.a.createElement("div",{className:"Home-userList"},i.map((function(n){var e,t,a,i;if(null==n)return null;var s=null===(e=n.songEvents)||void 0===e||null===(t=e.items)||void 0===t?void 0:t[0],o=null!==(a=null===s||void 0===s||null===(i=s.track)||void 0===i?void 0:i.albumImg)&&void 0!==a?a:null,l=k(n);return r.a.createElement(mn,{key:n.userID,img:o,title:n.displayName||n.userID,subtitle:"".concat(l," ").concat(1===l?"listener":"listeners"),cta:r.a.createElement(u.b,{className:"button",to:"/u/".concat(encodeURIComponent(n.displayName||n.userID))},"Join")})})),r.a.createElement(mn,{img:null,title:"My channel",subtitle:"lets do this",cta:r.a.createElement(u.b,{className:"button",to:"/broadcast"},"Host a channel")}))})))}var pn=function(){return r.a.createElement("div",{className:"Home EMContainer"},r.a.createElement("div",{className:"Home-list"},r.a.createElement(dn,null)),r.a.createElement("div",{className:"Home-content"},r.a.createElement("div",{className:""},r.a.createElement("em",null,"eardrum.monster allows you to sync your spotify client with friends")),r.a.createElement("h1",null,"How do I use it?"),r.a.createElement("div",null,"1. Join a channel or create your own \u261d\ufe0f"),r.a.createElement("div",null,"2. Share the URL with your friends\ufe0f"),r.a.createElement("h1",null,"Its great for:"),r.a.createElement("div",null,"\u2705 Streamers who want to let their viewers sync up their music with high quality spotify audio"),r.a.createElement("div",null,"\u2705 Online gamers who want listen together while gaming"),r.a.createElement("div",null,"\u2705 People who are quarantined and want to have virtual power hours together"),r.a.createElement("h1",null,"Did you say power hour?"),r.a.createElement("div",null,"\u2705 Yes! eardrum.monster now features ",r.a.createElement("em",null,"Power hour mode\u2122\ufe0f")," that will automatically change the song every 60s. Everybody must drink when the song changes."),r.a.createElement("h1",null,"Can I play century club?"),r.a.createElement("div",null,"\u2705 We've got you covered! ",r.a.createElement("em",null,"Power hour mode\u2122\ufe0f")," will keep em' coming well beyond the traditional 60 minutes so you can attempt to join the century club as many times as you want!")))};function vn(){var n=Object(l.h)(),e=w();return e&&"string"===typeof e.displayName?r.a.createElement(l.a,{to:"/u/".concat(encodeURIComponent(e.displayName))}):(window.location.href=T(n.pathname),null)}var fn=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(u.a,null,r.a.createElement(S,null,r.a.createElement(L,null),r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"/auth/"},r.a.createElement(N,null)),r.a.createElement(O,null,r.a.createElement("div",{className:"App-content"},r.a.createElement(l.b,{exact:!0,path:"/"},r.a.createElement(pn,null)),r.a.createElement(l.b,{path:"/u/:id"},r.a.createElement(cn,null)),r.a.createElement(l.b,{path:"/broadcast"},r.a.createElement(vn,null)),r.a.createElement(l.b,{path:"/premium_required"},r.a.createElement("div",{className:"App-msg"},"Error: Spotify premium required for syncing with eardrum.monster \ud83d\ude1e"))))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var gn={aws_project_region:"us-east-1",aws_appsync_graphqlEndpoint:"https://kponrlcw6jap7j62gb56h2abf4.appsync-api.us-east-1.amazonaws.com/graphql",aws_appsync_region:"us-east-1",aws_appsync_authenticationType:"API_KEY",aws_appsync_apiKey:"da2-jxgfvq7zzvacfozrt7vucdiipq"};t(15).default.configure(gn),s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(fn,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(n){n.unregister()})).catch((function(n){console.error(n.message)}))},51:function(n,e,t){n.exports=t.p+"static/media/logo.86828523.png"}},[[135,1,2]]]);
//# sourceMappingURL=main.149dbd2e.chunk.js.map