(this["webpackJsonpeardrum-monster"]=this["webpackJsonpeardrum-monster"]||[]).push([[0],[,,,function(e,t,n){e.exports=n.p+"static/media/logo.f7341243.svg"},,,,function(e,t,n){e.exports=n(14)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(2),i=n.n(r),c=(n(12),n(6)),s=n(3),l=n.n(s),u=(n(13),n(4)),p=n(5),d=function(){function e(t){Object(u.a)(this,e),this.accessToken=t,this.freshAccessToken=!0,this.player=null}return Object(p.a)(e,[{key:"fetchState",value:function(){return this.player?this.player.getCurrentState():(console.error("Player not initialized"),Promise.reject("player not initialized"))}},{key:"handleNewState",value:function(t){var n=this;if(t)if(t.paused)this.pause();else{var o=e.getUriFromState(t);null!=o?this.player?this.fetchState().then((function(a){null!=a?e.isAd(a)||(e.getUriFromState(a)!==o||!1!==a.paused?n.play(o):Math.abs(t.position-a.position)>1e4&&n.seek(t.position)):n.play(o)})):this.play(o):console.error("new uri is null",t)}}},{key:"pause",value:function(){return this.player.pause()}},{key:"seek",value:function(e){return this.player.seek(e)}},{key:"play",value:function(e){return fetch("https://api.spotify.com/v1/me/player/play?device_id=".concat(this.deviceId),{method:"PUT",body:JSON.stringify({uris:[e]}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then((function(e){e.ok||console.error("error playing uri")}))}},{key:"onPlayerStateChanged",value:function(t){var n=this;this.player.addListener("player_state_changed",(function(o){var a=e.getTrackFromState(o),r=e.getUriFromState(o);r===n.currentSongUri&&(a=null),n.currentSongUri=r,t({newState:o,newSong:a})}))}},{key:"prepareSpotifyClient",value:function(){var e=this;return new Promise((function(t){window.onSpotifyWebPlaybackSDKReady=function(){e.initializePlayer().then(t)};var n=document.createElement("script");n.src="https://sdk.scdn.co/spotify-player.js",document.body.appendChild(n)}))}},{key:"initializePlayer",value:function(){var e=this;return new Promise((function(t){e.player=new window.Spotify.Player({name:"eardrum.monster",getOAuthToken:e.fetchOauthToken.bind(e),volume:.5}),e.player.on("initialization_error",(function(e){var t=e.message;console.error("Failed to initialize",t)})),e.player.on("authentication_error",(function(e){var t=e.message;console.error("Failed to authenticate",t)})),e.player.on("account_error",(function(e){var t=e.message;console.error("Failed to validate Spotify account",t)})),e.player.on("playback_error",(function(e){var t=e.message;console.error("Failed to perform playback",t)})),e.player.on("ready",(function(n){var o=n.device_id;e.deviceId=o,fetch("https://api.spotify.com/v1/me/player",{method:"PUT",body:JSON.stringify({device_ids:[e.deviceId]}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)}}).then((function(e){e.ok?t():console.error("unable to transfer playback to web player")}))})),e.player.connect().then((function(e){e||console.error("Failed to connect to the web player")}))}))}},{key:"fetchOauthToken",value:function(e){this.freshAccessToken||console.error("fetchOauthToken called more than once"),e(this.accessToken)}},{key:"fetchCurrentDeviceId",value:function(){return fetch("https://api.spotify.com/v1/me/player",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.accessToken)}}).then((function(e){return e.ok||console.error("error fetching device id"),e.body.device&&e.body.device.id?e.body.device.id:null}))}},{key:"setDeviceId",value:function(e){this.deviceId=e}}],[{key:"getTrackFromState",value:function(e){return e&&e.track_window&&e.track_window.current_track?e.track_window.current_track:null}},{key:"getUriFromState",value:function(e){return e&&e.track_window&&e.track_window.current_track?e.track_window.current_track.uri:null}},{key:"isAd",value:function(e){return!!(e&&e.track_window&&e.track_window.current_track)&&"ad"===e.track_window.current_track.type}}]),e}();var h=function(){var e=encodeURIComponent("http://localhost:3000/"),t="https://accounts.spotify.com/authorize?response_type=token&client_id=".concat("d73f9dfa97c44b57ac7cefcc031c4df9","&scope=").concat("streaming+user-read-email+user-read-private+user-read-playback-state+user-modify-playback-state+user-read-currently-playing","&redirect_uri=").concat(e),n=a.a.useState(null),o=Object(c.a)(n,2),r=o[0],i=o[1];if(window.location.hash){var s={};window.location.hash.slice(1).split("&").map((function(e){return e.split("=")})).forEach((function(e){s[e[0]]=e[1]})),i(s.access_token),console.log("setaccesstoken"),window.location.hash=""}return a.a.useMemo((function(){if(console.log("inhere"),console.log(r),r){console.log("initing");var e=new d(r);e.prepareSpotifyClient().then((function(){return e.fetchState()})).then((function(t){console.log(t),e.play("spotify:track:727LbE4pV6RtLK5FnH1WIe")}))}}),[r]),a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("h1",{className:"App-title"},"EARDRUM MONSTER"),a.a.createElement("img",{src:l.a,className:"App-logo",alt:"logo"}),a.a.createElement("a",{href:t},"Login with Spotify")),a.a.createElement("div",null,a.a.createElement("h2",null,"now playing")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(h,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[7,1,2]]]);
//# sourceMappingURL=main.303ba272.chunk.js.map